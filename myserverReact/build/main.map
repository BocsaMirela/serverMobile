{"version":3,"sources":["webpack:///webpack/bootstrap 3f3fdb1ab006bdfe14d8","webpack:///./src/index.js","webpack:///./node_modules/babel-runtime/regenerator/index.js","webpack:///external \"regenerator-runtime\"","webpack:///external \"koa\"","webpack:///external \"http\"","webpack:///external \"ws\"","webpack:///external \"fs\"","webpack:///external \"koa-router\"","webpack:///external \"koa-cors\"","webpack:///external \"koa-jwt\"","webpack:///external \"jsonwebtoken\"","webpack:///external \"koa-bodyparser\""],"names":["Koa","require","app","server","createServer","callback","WebSocket","wss","Server","fs","Router","cors","koaJwt","jwt","bodyparser","koaJwtKey","use","ctx","next","start","Date","ms","console","log","method","url","response","status","body","issue","error","message","secret","unless","path","Entry","id","date","userId","imagePath","pathToEntriesFile","pathToUsersFile","saveToFile","jsonObject","writeFile","JSON","stringify","err","usersContent","readFileSync","contents","entries","parse","users","lastUpdated","length","lastId","sort","n1","n2","pageSize","broadcast","clients","forEach","client","readyState","OPEN","send","data","router","post","user","request","found","findIndex","obj","email","password","idUser","outcome","token","sign","role","get","query","page","parseInt","set","toUTCString","sortedEntries","offset","slice","more","entryId","params","entry","find","warning","createEntry","push","event","entryE","put","index","del","splice","routes","allowedMethods","listen"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 3f3fdb1ab006bdfe14d8","const Koa = require('koa');\r\nconst app = new Koa();\r\nconst server = require('http').createServer(app.callback());\r\nconst WebSocket = require('ws');\r\nconst wss = new WebSocket.Server({server});\r\nconst fs = require('fs');\r\nconst Router = require('koa-router');\r\nconst cors = require('koa-cors');\r\nconst koaJwt = require('koa-jwt');\r\nconst jwt = require('jsonwebtoken');\r\nconst bodyparser = require('koa-bodyparser');\r\n\r\n\r\nconst koaJwtKey = 'mySecretKey';\r\n\r\napp.use(bodyparser()); //1\r\napp.use(cors()); //2\r\napp.use(async (ctx, next) => { // logger\r\n    const start = new Date();\r\n    await next();\r\n    const ms = new Date() - start;\r\n    console.log(`${ctx.method} ${ctx.url} ${ctx.response.status} - ${ms}ms`);\r\n});\r\n\r\napp.use(async (ctx, next) => { // error handler\r\n    try {\r\n        await next();\r\n    } catch (err) {\r\n        ctx.response.body = {issue: [{error: err.message || 'Unexpected error'}]};\r\n        ctx.response.status = 500; // internal server error\r\n    }\r\n});\r\n\r\napp.use(koaJwt({secret: koaJwtKey}).unless({path: [/^\\/auth/]}));\r\n\r\nclass Entry {\r\n    constructor({id, body, date, userId, imagePath}) {\r\n        this.id = id;\r\n        this.body = body;\r\n        this.date = date;\r\n        this.userId = userId\r\n        this.imagePath = imagePath\r\n    }\r\n}\r\n\r\nconst pathToEntriesFile = 'data/entries.json';\r\nconst pathToUsersFile = 'data/users.json';\r\n\r\nconst saveToFile = (jsonObject) => {\r\n    fs.writeFile(pathToEntriesFile, JSON.stringify(jsonObject), function (err) {\r\n        if (err) {\r\n            return console.log(err);\r\n        }\r\n    });\r\n}\r\n\r\nconst usersContent = fs.readFileSync(pathToUsersFile, 'utf8', function (err) {\r\n    if (err) {\r\n        return console.log(err);\r\n    }\r\n});\r\n\r\nconst contents = fs.readFileSync(pathToEntriesFile, 'utf8', function (err) {\r\n    if (err) {\r\n        return console.log(err);\r\n    }\r\n});\r\n\r\nconst entries = (JSON.parse(contents));\r\nconst users = JSON.parse(usersContent);\r\nlet lastUpdated = entries[entries.length - 1].date;\r\nlet lastId = entries.sort((n1, n2) => (n1.id - n2.id))[entries.length - 1].id;\r\n\r\nconst pageSize = 10;\r\n\r\nconst broadcast = data => {\r\n    wss.clients.forEach(client => {\r\n        if (client.readyState === WebSocket.OPEN) {\r\n            client.send(JSON.stringify(data));\r\n        }\r\n    });\r\n}\r\n\r\nconst router = new Router();\r\n\r\nrouter.post('/auth', async (ctx) => {\r\n    const user = ctx.request.body;\r\n    console.log(user);\r\n    const found = users.findIndex(obj => obj.email === user.email && obj.password === user.password);\r\n    const idUser = users[found].id\r\n    console.log(\"idUser\" + idUser)\r\n    if (found != -1) {\r\n        ctx.response.body = {outcome: 'Succes'};\r\n        ctx.response.status = 200;\r\n        ctx.body = {\r\n            token: jwt.sign({role: 'admin'}, koaJwtKey), //Should be the same secret key as the one used is ./koaJwt.js\r\n            id: idUser,\r\n            message: \"Successfully logged in!\"\r\n        };\r\n    } else {\r\n        ctx.response.body = {outcome: 'Succes'};\r\n        ctx.response.status = 200;\r\n        ctx.body = {\r\n            token: \"\", //Should be the same secret key as the one used is ./koaJwt.js\r\n            id: \"\",\r\n            message: \"Wrong\"\r\n        };\r\n    }\r\n});\r\n\r\n\r\nrouter.get('/entry', ctx => {\r\n    console.log(\"daaa\")\r\n    const body = ctx.request.query.body;\r\n    const page = parseInt(ctx.request.query.page) || 1;\r\n    ctx.response.set('Last-Modified', new Date(lastUpdated).toUTCString());\r\n    const sortedEntries = entries\r\n        .sort((n1, n2) => -(n1.date - n2.date));\r\n    const offset = (page - 1) * pageSize;\r\n    ctx.response.body = {\r\n        page,\r\n        entries: sortedEntries.slice(offset, offset + pageSize),\r\n        more: offset + pageSize < sortedEntries.length\r\n    };\r\n    ctx.response.status = 200; // OK\r\n});\r\n\r\nrouter.get('/entry/all', ctx => {\r\n    console.log(\"daaa\")\r\n    const sortedEntries = entries.sort((n1, n2) => -(n1.date - n2.date));\r\n    ctx.response.body = sortedEntries\r\n    ctx.response.status = 200; // OK\r\n});\r\n\r\nrouter.get('/entry/check', ctx => {\r\n    console.log(\"daaa\")\r\n    ctx.response.body = \"ok\"\r\n    ctx.response.status = 200; // OK\r\n});\r\n\r\nrouter.get('/entry/:id', async (ctx) => {\r\n    const entryId = ctx.request.params.id;\r\n    const entry = entries.find(entry => entryId === entry.id);\r\n    if (entry) {\r\n        ctx.response.body = entry;\r\n        ctx.response.status = 200; // ok\r\n    } else {\r\n        ctx.response.body = {issue: [{warning: `Entry with id ${entryId} not found`}]};\r\n        ctx.response.status = 404; // NOT FOUND (if you know the resource was deleted, then return 410 GONE)\r\n    }\r\n});\r\n\r\nconst createEntry = async (ctx) => {\r\n    const entry = ctx.request.body;\r\n    console.log(\"create entru\" + entry.body);\r\n    if (!entry.body) { // validation\r\n        console.log(\"create entru empty body\" + entry);\r\n        ctx.response.body = {issue: [{error: 'Entry body is missing'}]};\r\n        ctx.response.status = 400; //  BAD REQUEST\r\n        return;\r\n    }\r\n    console.log(\"create entru passed\" + entry);\r\n    if (!entry.id)\r\n        // entry.id = `${parseInt(lastId) + 1}`;\r\n        entry.id = parseInt(lastId) + 1;\r\n     // lastId = entry.id;\r\n    if (entry.id>lastId){\r\n        lastId=entry.id+1\r\n    }else{\r\n        lastId=lastId+1\r\n    }\r\n    entries.push(entry);\r\n    ctx.response.body = entry;\r\n    ctx.response.status = 201; // CREATED\r\n    broadcast({event: 'created', entry});\r\n};\r\n\r\n\r\nrouter.post('/entry', async (ctx) => {\r\n    console.log(\"add\" + ctx.request.body.id)\r\n    const entryE = ctx.request.body\r\n    let id=entryE.id\r\n    await createEntry(ctx);\r\n    saveToFile(entries);\r\n    if(!id){\r\n        id= parseInt(lastId)-1\r\n    }\r\n    const entry = entries.find(entry => entry.id==id);\r\n    if (entry) {\r\n        ctx.response.body = entry;\r\n        ctx.response.status = 200; // ok\r\n    } else {\r\n        ctx.response.body = {issue: [{warning: `Entry with id ${entryId} not found`}]};\r\n        ctx.response.status = 404; // NOT FOUND (if you know the resource was deleted, then return 410 GONE)\r\n    }\r\n});\r\n\r\n\r\nrouter.put('/entry/:id/:userId', async (ctx) => {\r\n    console.log(\"update\" + ctx.request.body.id)\r\n    const id = ctx.params.id;\r\n    const idUser = ctx.params.userId;\r\n    const entry = ctx.request.body;\r\n    const entryId = entry.id;\r\n    console.log(\"update\" + entryId)\r\n    console.log(\"update user id \" + idUser)\r\n    if (id != entry.id) {\r\n        console.log(\"update not 1  good\")\r\n        ctx.response.body = {issue: [{error: `Param id and body id should be the same`}]};\r\n        ctx.response.status = 400; // BAD REQUEST\r\n        return;\r\n    }\r\n    // if (!noteId) {\r\n    //   await createEntry(ctx);\r\n    //   return;\r\n    // }\r\n    const index = entries.findIndex(obj => obj.id == id && obj.userId == idUser);\r\n    if (index === -1) {\r\n        console.log(\"update not  good\")\r\n        ctx.response.body = {issue: [{error: `Entry with id ${id} not found`}]};\r\n        ctx.response.status = 400; // BAD REQUEST\r\n        return;\r\n    }\r\n    // if (noteVersion < entries[index].version) {\r\n    //   ctx.response.body = {issue: [{error: `Version conflict`}]};\r\n    //   ctx.response.status = 409; // CONFLICT\r\n    //   return;\r\n    // }\r\n    entries[index] = entry;\r\n    ctx.response.body = entry;\r\n    ctx.response.status = 200; // OK\r\n    broadcast({event: 'updated', entry});\r\n    console.log(\"update  good \" + entry.body)\r\n    saveToFile(entries);\r\n});\r\n\r\nrouter.del('/entry/:id/:userId', ctx => {\r\n    const id = ctx.params.id;\r\n    const idUser = ctx.params.userId;\r\n    const index = entries.findIndex(entry => id == entry.id && idUser == entry.userId);\r\n    if (index !== -1) {\r\n        const entry = entries[index];\r\n        entries.splice(index, 1);\r\n        lastUpdated = new Date();\r\n        broadcast({event: 'deleted', entry});\r\n    }\r\n    ctx.response.status = 204; // no content\r\n    ctx.response.body = entries[index];\r\n    saveToFile(entries);\r\n\r\n});\r\n\r\n// setInterval(() => {\r\n//   lastUpdated = new Date();\r\n//   lastId = `${parseInt(lastId) + 1}`;\r\n//   const note = new Note({ id: lastId, text: `Note ${lastId}`, date: lastUpdated, version: 1 });\r\n//   entries.push(note);\r\n//   console.log(`\r\n//    ${note.text}`);\r\n//   broadcast({ event: 'created', note });\r\n// }, 15000);\r\n\r\napp.use(router.routes());\r\napp.use(router.allowedMethods());\r\n\r\nserver.listen(3000);\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = require(\"regenerator-runtime\");\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/babel-runtime/regenerator/index.js\n// module id = 2\n// module chunks = 0","module.exports = require(\"regenerator-runtime\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"regenerator-runtime\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"koa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"http\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"http\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"ws\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ws\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"koa-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-router\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"koa-cors\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-cors\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"koa-jwt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-jwt\"\n// module id = 10\n// module chunks = 0","module.exports = require(\"jsonwebtoken\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsonwebtoken\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"koa-bodyparser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-bodyparser\"\n// module id = 12\n// module chunks = 0"],"sourceRoot":""}